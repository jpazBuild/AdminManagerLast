# ğŸ“Œ Usa Webtop como base con Ubuntu XFCE
FROM lscr.io/linuxserver/webtop:ubuntu-xfce

# ğŸ¢ Establecer directorio de trabajo
WORKDIR /app

# ğŸŒ Instalar Node.js, Playwright y dependencias necesarias
RUN apt-get update && \
    apt-get install -y curl wget gpg ca-certificates software-properties-common && \
    curl -sL https://deb.nodesource.com/setup_18.x | bash - && \
    apt-get install -y nodejs && \
    npm install -g yarn && \
    apt-get install -y git xvfb dbus-x11 && \
    rm -rf /var/lib/apt/lists/*

# ğŸ­ Instalar Playwright con todos los navegadores
RUN npm install -g playwright && \
    npx playwright install --with-deps

# ğŸ“¦ Copiar los archivos del proyecto y sus dependencias
COPY package*.json ./
RUN npm install

# ğŸ“‚ Copiar el cÃ³digo fuente
COPY . .

# ğŸš€ ConstrucciÃ³n del proyecto
RUN npm run build

# ğŸ“¡ Exponer puertos para API y Webtop
EXPOSE 3000 4000

# ğŸ–¥ï¸ Iniciar Webtop y la API
CMD ["sh", "-c", "npm run dev & /init"]